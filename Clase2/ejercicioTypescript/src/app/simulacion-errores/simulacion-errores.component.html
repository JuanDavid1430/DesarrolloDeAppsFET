<div class="sistema-analisis-vectorial">
  <!-- Header Principal -->
  <header class="header-principal">
    <div class="header-content">
      <h1>ğŸ”¬ Sistema de AnÃ¡lisis Vectorial del Flujo de CÃ³digo</h1>
      <p class="subtitle">DetecciÃ³n AutomÃ¡tica de AnomalÃ­as basado en Campos Vectoriales</p>
    </div>
  </header>

  <!-- Panel de Control -->
  <section class="panel-control">
    <div class="control-container">
      <h3>ğŸ›ï¸ Panel de Control</h3>
      <div class="botones-control">
        <button class="btn-primary" (click)="simularNuevoVector()">
          â• Generar Nuevo Vector
        </button>
        <button class="btn-warning" (click)="limpiarReportes()">
          ğŸ—‘ï¸ Limpiar Reportes
        </button>
        <button class="btn-danger" (click)="reiniciarAnalisis()">
          ğŸ”„ Reiniciar AnÃ¡lisis
        </button>
        <button class="btn-success" (click)="exportarReportesATxt()" [disabled]="reportes.length === 0">
          ğŸ“„ Exportar TXT
        </button>
        <button class="btn-info" (click)="exportarReportesJSON()" [disabled]="reportes.length === 0">
          ğŸ“¦ Exportar JSON
        </button>
      </div>
    </div>
  </section>

  <!-- Panel de EstadÃ­sticas -->
  <section class="estadisticas-panel">
    <div class="estadistica-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-info">
        <div class="stat-value">{{ estadisticas.magnitudPromedio.toFixed(2) }}</div>
        <div class="stat-label">Magnitud Promedio</div>
      </div>
    </div>
    <div class="estadistica-card">
      <div class="stat-icon">ğŸ“ˆ</div>
      <div class="stat-info">
        <div class="stat-value">{{ estadisticas.desviacionEstandar.toFixed(2) }}</div>
        <div class="stat-label">DesviaciÃ³n EstÃ¡ndar</div>
      </div>
    </div>
    <div class="estadistica-card ok">
      <div class="stat-icon">âœ…</div>
      <div class="stat-info">
        <div class="stat-value">{{ estadisticas.vectoresOk }}</div>
        <div class="stat-label">Vectores OK</div>
      </div>
    </div>
    <div class="estadistica-card warning">
      <div class="stat-icon">âš ï¸</div>
      <div class="stat-info">
        <div class="stat-value">{{ estadisticas.vectoresConWarning }}</div>
        <div class="stat-label">Warnings</div>
      </div>
    </div>
    <div class="estadistica-card error">
      <div class="stat-icon">âŒ</div>
      <div class="stat-info">
        <div class="stat-value">{{ estadisticas.vectoresConError }}</div>
        <div class="stat-label">Errores</div>
      </div>
    </div>
    <div class="estadistica-card alert">
      <div class="stat-icon">âš¡</div>
      <div class="stat-info">
        <div class="stat-value">{{ estadisticas.cambiosBruscosDetectados }}</div>
        <div class="stat-label">Cambios Bruscos</div>
      </div>
    </div>
  </section>

  <!-- SecciÃ³n de GrÃ¡ficas -->
  <section class="graficas-container">
    <!-- GrÃ¡fica 1: Campo Vectorial -->
    <div class="grafica-card">
      <div class="card-header">
        <h3>ğŸ“ Campo Vectorial de Flujo</h3>
        <p class="card-description">RepresentaciÃ³n espacial del flujo de ejecuciÃ³n del cÃ³digo</p>
      </div>
      <div class="chart-wrapper">
        <canvas #vectorFieldChart></canvas>
      </div>
    </div>

    <!-- GrÃ¡fica 2: AnÃ¡lisis de Magnitudes -->
    <div class="grafica-card">
      <div class="card-header">
        <h3>ğŸ“ˆ AnÃ¡lisis de Magnitudes</h3>
        <p class="card-description">EvoluciÃ³n de la complejidad con lÃ­nea de promedio</p>
      </div>
      <div class="chart-wrapper">
        <canvas #magnitudChart></canvas>
      </div>
    </div>

    <!-- GrÃ¡fica 3: DistribuciÃ³n de Estados -->
    <div class="grafica-card">
      <div class="card-header">
        <h3>ğŸ¥§ DistribuciÃ³n de Estados</h3>
        <p class="card-description">ProporciÃ³n de vectores por estado</p>
      </div>
      <div class="chart-wrapper">
        <canvas #estadoChart></canvas>
      </div>
    </div>
  </section>

  <!-- SecciÃ³n de Vectores Activos -->
  <section class="vectores-activos">
    <h3>ğŸŒ Vectores Activos en el Sistema</h3>
    <div class="vectores-grid">
      <div 
        *ngFor="let vector of vectores; trackBy: trackByVectorId" 
        class="vector-card"
        [ngClass]="'estado-' + vector.estado">
        <div class="vector-header">
          <span class="vector-id">{{ vector.id }}</span>
          <span class="vector-estado">{{ getEstadoIcon(vector.estado) }} {{ vector.estado.toUpperCase() }}</span>
        </div>
        <div class="vector-body">
          <div class="vector-flujo">
            <strong>{{ vector.origen }}</strong> 
            <span class="arrow">â†’</span> 
            <strong>{{ vector.destino }}</strong>
          </div>
          <div class="vector-detalles">
            <div class="detalle-item">
              <span class="label">Magnitud:</span>
              <span class="value">{{ vector.magnitud.toFixed(2) }}</span>
            </div>
            <div class="detalle-item">
              <span class="label">DirecciÃ³n:</span>
              <span class="value">{{ vector.direccion }}</span>
            </div>
            <div class="detalle-item timestamp">
              <span class="label">Timestamp:</span>
              <span class="value">{{ formatearFecha(vector.timestamp) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SecciÃ³n de Reportes de AnomalÃ­as -->
  <section class="reportes-anomalias">
    <h3>ğŸš¨ Reportes AutomÃ¡ticos de AnomalÃ­as</h3>
    
    <div *ngIf="reportes.length === 0" class="no-reportes">
      <div class="no-reportes-icon">âœ¨</div>
      <p>No se han detectado anomalÃ­as en el sistema</p>
    </div>

    <div *ngIf="reportes.length > 0" class="reportes-lista">
      <div 
        *ngFor="let reporte of reportes; trackBy: trackByReporteId" 
        class="reporte-card"
        [ngClass]="getSeveridadClass(reporte.severidad)">
        <div class="reporte-header">
          <div class="reporte-tipo">
            <span class="tipo-icon">{{ getTipoIcon(reporte.tipo) }}</span>
            <span class="tipo-texto">{{ reporte.tipo.toUpperCase() }}</span>
          </div>
          <div class="reporte-severidad">
            <span class="badge" [ngClass]="getSeveridadClass(reporte.severidad)">
              {{ reporte.severidad.toUpperCase() }}
            </span>
          </div>
        </div>
        <div class="reporte-body">
          <p class="reporte-descripcion">{{ reporte.descripcion }}</p>
          <div *ngIf="reporte.vectorRelacionado" class="vector-relacionado">
            <strong>Vector relacionado:</strong> 
            {{ reporte.vectorRelacionado.id }} 
            ({{ reporte.vectorRelacionado.origen }} â†’ {{ reporte.vectorRelacionado.destino }})
          </div>
        </div>
        <div class="reporte-footer">
          <span class="reporte-fecha">ğŸ•’ {{ formatearFecha(reporte.fecha) }}</span>
          <span class="reporte-id">ID: {{ reporte.id }}</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer con informaciÃ³n -->
  <footer class="footer-info">
    <div class="footer-content">
      <div class="info-section">
        <h4>ğŸ¯ Objetivo del AnÃ¡lisis</h4>
        <p>Modelar el flujo de ejecuciÃ³n como un campo vectorial para detectar automÃ¡ticamente anomalÃ­as mediante anÃ¡lisis de magnitud, direcciÃ³n y secuencia.</p>
      </div>
      <div class="info-section">
        <h4>ğŸ“‹ Tipos de AnomalÃ­as Detectadas</h4>
        <ul>
          <li><strong>Magnitud:</strong> Valores fuera de rango esperado</li>
          <li><strong>DirecciÃ³n:</strong> Cambios bruscos en el flujo</li>
          <li><strong>Estado:</strong> Errores consecutivos</li>
          <li><strong>Secuencia:</strong> Patrones crÃ­ticos detectados</li>
        </ul>
      </div>
    </div>
  </footer>
</div>
